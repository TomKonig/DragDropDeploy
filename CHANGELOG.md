# Changelog

All notable changes to this project will be documented in this file.

## Unreleased

### Added

- Adopt: Hierarchical roadmap issue model with single parent `[slug]` issue + sub-issues (replaces per-issue slug prefix pattern)

- Project-level build flags (`ProjectSetting.buildFlags`) with allowlist enforcement (`BUILD_FLAGS_ALLOWLIST`), executor integration, and redacted logging.
- Static asset minification service (HTML/CSS/JS) with per-project opt-out (`optOutMinify`) and host override (`FORCE_MINIFY`).
- Deployment archive upload endpoint enhancements since 0.0.2 (artifact processing groundwork for orchestration follow-up).
- Roadmap automation: support `status: done` in `roadmap.yaml` so shipped slugs no longer require interim tracking issues (#113).
- Enforceable monorepo ESLint baseline with typed rules and scoped test/config overrides (#114).
- Artifact cleanup script (`scripts/cleanup-artifacts.cjs`) and root `clean:artifacts` npm script for repository hygiene (#115).
- Roadmap generator uses YAML item status (done/in-progress/etc.) for icons; validator tolerates done items without active issues and detects duplicate prefixed issues (improved roadmap gating heuristics).
- Roadmap validation refinement: introduce FullyClosedNotDone / OpenIssuesForDone categories and enforce that `status: done` slugs have zero OPEN issues while active slugs must retain ≥1 (policy header updated; legacy reopened issues closed out #12 #55 #106).

### Changed

- Local full CI parity script (`ci:full`) and enhanced pre-push hook (runs docs:check, Prisma client generation, coverage, builds) to catch documentation/API drift pre-push.
- Documentation generation now enforces zero internal TypeDoc warnings (new strict wrapper) – exported public types and excluded shim definitions to keep API docs complete.
- Roadmap validation now categorizes errors (Missing/Duplicate/Orphan/InvalidStatus), previously exempted `status: done` slugs from requiring open issues, and adds new DX slugs (lint-hardening, repo-hygiene, dev-tooling) to canonical YAML.
- Removed temporary open-issue-per-slug policy in favor of refined status-driven rules (see Added) allowing closure of shipped slug issues instead of perpetual reopening.
- Adjust markdownlint rule set: disable MD003 (heading style normalization) and MD026 (no trailing punctuation) while keeping structural/enforcement rules (MD012, MD022, MD040, etc.) to reduce churn and focus on rendering-impacting issues.
- Temporarily ignore autogenerated `docs/reference/api.md` in markdownlint pending fenced code language normalization in generator (follow-up issue to remove ignore).
- Unified CI parity: single `ci:full:strict` pipeline invoked locally (pre-push) and in GitHub Actions (workflow collapsed to one step, reordered to run Prisma generation first, added clean tree verification).
- Local services auto-start: pre-push now spins up Postgres & Redis via docker compose (skip with SKIP_SERVICES=1) for full environment parity.

### Fixed

- Robust fence lint: replace narrow docs/reference-only scanner with full docs tree unlabeled fence detector excluding generated dir (pure Node, no grep quoting risks).
- Local vs GitHub CI parity: pre-push now runs `ci:full:strict` (adds clean tree verification) and workflow adds the same clean tree check.
- Roadmap sync script auto-loads .env (dotenv) so GH_TOKEN is honored outside husky pre-push hook.

- Stricter docs gating: env documentation check now fails CI when unused documented variables are present (prevents silent drift).
- Documentation scan consistency: all scans hard-fail on issues except roadmap issue linkage which permissively skips when no GH token is provided (local dev convenience).
- API reference markdown: insert blank line after raw anchor tags before headings to satisfy markdownlint MD022 (prevents recurring lint failure during docs:check).
- Eliminate unsafe implicit Prisma result inference causing `@typescript-eslint/no-unsafe-*` CI failures by adding explicit model return types across services and controllers (#116).
- Ensure Prisma Client is generated prior to lint via new `prelint` script preventing type fallback to `any` in CI (#116).
- Resolve shared package path resolution issues in CI by adding TypeScript import resolver configuration (monorepo path aliases) (#116).
- Harden build executor e2e test with retries, timeline capture, and richer timeout diagnostics to mitigate intermittent flake.
- Enforce code fence languages in reference docs (fail build on unlabeled fenced blocks via new `docs:lint:fences` step) preventing recurring MD040 violations.

### Security

- Replace pre-push `ci:all` with `ci:full` including docs and coverage for local failure parity with GitHub workflow.
- Resolve widespread TypeScript module resolution failures caused by incomplete package installations (restored proper `dist` contents via tarball extraction) (#115).

## 0.0.2 - 2025-09-12

### Added

- /auth/me endpoint returning current user profile (excludes passwordHash).
- Public route decorator & guard bypass logic.
- CONFIGURATION.md documenting env vs dashboard-managed settings plus expanded .env.example with all planned variables.
- Health endpoint e2e test coverage (public and internal restrictions).
- Random password generator for tests to eliminate hardcoded secret patterns.
- VERSIONING.md documenting semantic versioning & tagging strategy.
- ROLLBACK.md with standard rollback procedures.
- docker-compose.prod.yml with network segmentation & container hardening options.
- GitHub Actions CI workflow: build/test on pushes & PRs; image publish on version tags.
- Operator bootstrap: first registered user automatically elevated to OPERATOR (with role field persisted) and plugin userCreated hook invoked.
- In-memory auth endpoint rate limiting (configurable via RATE_LIMIT_AUTH_CAPACITY / RATE_LIMIT_AUTH_WINDOW_MS env vars).
- Settings persistence layer: SystemSetting & ProjectSetting tables + SettingType enum + SettingsService with in-memory cache.
- Deployment record creation on upload (now immediate transition to BUILDING with BuildJob creation) and e2e test coverage.
- Security hardening middleware: Helmet + explicit CORS origins loading from CORS_ORIGINS env var.
- Deployment archive upload endpoint (`POST /deployments/upload`):
  - In-memory buffer handling & ZIP extraction (path traversal, file count, compression ratio, magic number guards)
  - Artifact persisted to `ARTIFACTS_DIR` with recorded `artifactPath`
  - Deployment status immediately set to BUILDING; BuildJob row created (PENDING)
  - Configurable size via `MAX_UPLOAD_MB` (default 25) and storage root via `ARTIFACTS_DIR`
  - E2E tests: happy path, build job creation, oversize rejection, traversal attempt, non-zip rejection

### Partial / In Progress

- Deployment build execution & final status transitions (BUILDING -> ACTIVE/FAILED) not yet implemented.

### Changed

- Implemented global role + JWT guards with Public decorator for unauthenticated endpoints.
- Project (Site) CRUD fully validated & ownership enforced; marked complete in task list.
- Updated tasklist to reflect implemented security/auth tasks.

### Security

- Removed hardcoded test passwords (replaced with random generation).
- Snyk scans executed (no medium/high issues introduced; remaining low findings are dynamic credential usage in tests).
- Production compose adds: internal-only DB/Redis network, dropped capabilities (ALL), no-new-privileges, read-only FS (frontend & traefik), resource limits.
- Added initial auth rate limiting (brute force mitigation) & security headers (Helmet) + stricter CORS configuration.

<!-- Consolidated former Post-0.0.2 sections into standard Unreleased buckets per style guide. -->
